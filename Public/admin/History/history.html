<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Request Histories</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="../styles.css" rel="stylesheet" type="text/css">
    <link href="history.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div class="navbar-no-shadow">
        <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease"
            role="banner" class="navbar-no-shadow-container w-nav">
            <div class="container-regular">
                <div class="navbar-wrapper">
                    <div class="w-layout-hflex ceuvaultbrandflex">
                        <a href="#" class="ceulogo w-nav-brand"><img width="85" loading="lazy" alt=""
                                src="../images/CEU-Logo.png" class="image"></a>
                        <div class="w-layout-hflex ceuvaultbrandtext">
                            <h4 class="heading">Centro Escolar University</h4>
                            <h1 class="heading-2">CEU <span class="text-span">VAULT</span></h1>
                            <h5 class="heading-3">MALOLOS TLTS FACILITY</h5>
                        </div>
                    </div>
                    <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
                        <ul role="list" class="nav-menu w-list-unstyled">
                            <li class="list-item-2">
                                <a href="../Inventory Status/inventoryStatus.html" aria-current="page"
                                    class="button-primary w-button w--current">INVENTORY STATUS</a>
                            </li>
                            <li class="list-item">
                                <a href="../History/history.html" class="button-primary w-button">REQUESTS</a>
                            </li>
                            <li class="list-item-3">
                                <a href="../History/history.html" class="button-primary w-button">REQUISITION
                                    HISTORY</a>
                            </li>
                        </ul>
                    </nav>
                    <div class="menu-button w-nav-button">
                        <div class="icon w-icon-nav-menu"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section>
        <div class="container mt-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="">Borrowing Requests Status</h1>
            </div>
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="tableContainer" class="table-responsive"></div>
                </div>
            </div>
        </div>

        <script>
            let currentSortOrder = 'asc'; // Track current sort order

            // Call the getAllBorrowingRequests API when the page loads
            document.addEventListener("DOMContentLoaded", function () {
                fetchBorrowingRequestsData();
            });

            // Fetch data from the getAllBorrowingRequests API
            async function fetchBorrowingRequestsData() {
                try {
                    const response = await fetch('http://localhost:8000/equipments/get-all-requests'); // Adjust API endpoint if needed
                    const data = await response.json();

                    if (data.successful && data.borrowingRequests) {
                        displayTable(data.borrowingRequests);
                    } else {
                        document.getElementById('tableContainer').innerHTML = `<p>${data.message}</p>`;
                    }
                } catch (error) {
                    document.getElementById('tableContainer').innerHTML = `<p>Error fetching borrowing requests data: ${error.message}</p>`;
                }
            }

            // Display the data in a Bootstrap table
            function displayTable(borrowingData) {
                const table = document.createElement('table');
                table.classList.add('table', 'table-striped', 'table-bordered', 'table-hover', 'table-sm', 'text-center');

                // Create table header
                const thead = document.createElement('thead');
                thead.classList.add('thead-dark');
                const headerRow = document.createElement('tr');

                // Headers for the table
                const headers = [
                    { text: 'Equipment Materials', field: 'equipment_materials' },
                    { text: 'Venue', field: 'venue' },
                    { text: 'Class Schedule', field: 'class_schedule' },
                    { text: 'Borrower', field: 'borrower' },
                    { text: 'School/College', field: 'school_college' },
                    { text: 'Request Received By', field: 'request_received_by' },
                    { text: 'MCL Pass No.', field: 'mcl_pass_no' },
                    { text: 'Time Borrowed', field: 'time_borrowed' },
                    { text: 'Released By', field: 'released_by' },
                    { text: 'Time Returned', field: 'time_returned' },
                    { text: 'Received By', field: 'received_by' },
                    { text: 'Remarks', field: 'remarks' }
                ];

                headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header.text;
                    headerRow.appendChild(th);
                });

                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Create table body
                const tbody = document.createElement('tbody');

                borrowingData.forEach(item => {
                    const tr = document.createElement('tr');
                    const fields = [
                        item.equipment_materials,
                        item.venue,
                        new Date(item.class_schedule).toLocaleString(), // Formatting the date
                        item.borrower,
                        item.school_college,
                        item.request_received_by,
                        item.mcl_pass_no,
                        new Date(item.time_borrowed).toLocaleString(), // Formatting the date
                        item.released_by,
                        item.time_returned ? new Date(item.time_returned).toLocaleString() : 'N/A', // Formatting the date if available
                        item.received_by,
                        item.remarks || 'N/A' // Display 'N/A' if remarks are null
                    ];

                    fields.forEach(field => {
                        const td = document.createElement('td');
                        td.textContent = field !== null ? field : 'N/A';
                        tr.appendChild(td);
                    });

                    tbody.appendChild(tr);
                });

                table.appendChild(tbody);

                // Insert table into the container
                const tableContainer = document.getElementById('tableContainer');
                tableContainer.innerHTML = '';  // Clear previous content
                tableContainer.appendChild(table);
            }
        </script>
    </section>


    </div>
    <div class="footer">
        <p class="paragraph-2">‍<strong class="bold-text-4">CEU VAULT<br>‍</strong>© 2024 Copyright <a
                href="https://www.ceu.edu.ph/" class="link"><strong class="bold-text-2">Centro Escolar University
                </strong></a><strong class="bold-text-3"><br></strong>Km. 44,
            Macarthur Highway, Longos, Malolos, Bulacan<br>All rights reserved.</p>
    </div>

    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66e266eb815840690d1652d0"
        type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
    <script src="../scripts/script.js" type="text/javascript"></script>

</body>

</html>